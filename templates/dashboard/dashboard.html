{% extends 'dashboard/dashbase.html' %}

{% block head %}
    {{ super() }}
    <script>
        window.onload = function setActiveLink() {
            $('#homeLink').addClass('active');
        }
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.bundle.js" integrity="sha256-qSIshlknROr4J8GMHRlW3fGKrPki733tLq+qeMCR05Q=" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.css" integrity="sha256-IvM9nJf/b5l2RoebiFno92E5ONttVyaEEsdemDC6iQA=" crossorigin="anonymous" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.js" integrity="sha256-arMsf+3JJK2LoTGqxfnuJPFTU4hAK57MtIPdFpiHXOU=" crossorigin="anonymous"></script>
{% endblock %}

{% block dashboardContent %}
    <div class="row h-100">
        <div class="col">

        </div>
        <div class="col">
            <canvas id="myChart" width="100%" height="50%"></canvas>
            <script>
                var ctx = document.getElementById('myChart').getContext('2d');
                var chartOne = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: ['0', '0', '0', '0', '0'],
                        datasets : [{
                            label: 'Temperature',
                            data: [0,0,0,0,0],
                            backgroundColor: [
                                'rgba(247, 67, 67, 1.0)'
                            ]
                        }, {
                            label: 'Humidity',
                            data: [0,0,0,0,0],
                            backgroundColor: [
                                'rgba(67, 148, 247, 1.0)'
                            ]
                        }]
                    }
                })
                $.ajax({
                    type: "GET",
                    url: "/api/data/sensor?sensorID=1",
                    complete: function(response) {
                        sensorData = response.responseJSON['data'];
                        for (var i = 0; i<sensorData.length; i++) {
                            dataPoint = sensorData[i];
                            var date = new Date(dataPoint['time']*1000).toLocaleString();
                            var temperature = dataPoint['temperature'];
                            var humidity = dataPoint['humidity'];
                            chartOne.data.labels[i] = date;
                            chartOne.data.datasets[0].data[i] = temperature;
                            chartOne.data.datasets[1].data[i] = humidity;
                        }
                        chartOne.update();
                    }
                })
            </script>
        </div>
        <div class="col">
            
        </div>
    </div>
{% endblock %}